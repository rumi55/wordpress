/* ======================================================= 
 * Auto Grid Responsive Gallery
 * By David Blanco
 *
 * Contact: http://codecanyon.net/user/davidbo90
 *
 * Created: June 6, 2013
 *
 * Copyright (c) 2013, David Blanco. All rights reserved.
 * Released under CodeCanyon License http://codecanyon.net/
 *
 * Note: Script based in jQuery Masonry v2.1.07 made by David DeSandro http://masonry.desandro.com/ (under MIT)
 *
 * ======================================================= */

(function(e,f,g){var b=f.event,a=f.event.handle?"handle":"dispatch",d;b.special.smartresize={setup:function(){f(this).bind("resize",b.special.smartresize.handler)},teardown:function(){f(this).unbind("resize",b.special.smartresize.handler)},handler:function(k,h){var j=this,i=arguments;k.type="smartresize";if(d){clearTimeout(d)}d=setTimeout(function(){b[a].apply(j,i)},h==="execAsap"?0:100)}};f.fn.smartresize=function(h){return h?this.bind("smartresize",h):this.trigger("smartresize",["execAsap"])};f.Mason=function(h,i){this.element=f(i);this._create(h);this._init()};f.Mason.settings={isResizable:true,isAnimated:false,animationOptions:{queue:false,duration:500},gutterWidth:0,isRTL:false,isFitWidth:false,containerStyle:{position:"relative"}};f.Mason.prototype={_resized:false,_filterFindBricks:function(i){var h=this.options.itemSelector;return !h?i:i.filter(h).add(i.find(h))},_getBricks:function(i){var h=this._filterFindBricks(i).css({position:"absolute"}).addClass("grid-brick");return h},_create:function(k){this.options=f.extend(true,{},f.Mason.settings,k);this.styleQueue=[];var j=this.element[0].style;this.originalStyle={height:j.height||""};var l=this.options.containerStyle;for(var n in l){this.originalStyle[n]=j[n]||""}this.element.css(l);this.horizontalDirection=this.options.isRTL?"right":"left";var i=this.element.css("padding-"+this.horizontalDirection);var m=this.element.css("padding-top");this.offset={x:i?parseInt(i,10):0,y:m?parseInt(m,10):0};this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth==="function";var h=this;setTimeout(function(){h.element.addClass("grid")},0);if(this.options.isResizable){f(e).bind("smartresize.grid",function(){h.resize()})}this.reloadItems()},_init:function(h){this._getColumns();this._reLayout(h)},option:function(h,i){if(f.isPlainObject(h)){this.options=f.extend(true,this.options,h)}},layout:function(p,q){for(var n=0,o=p.length;n<o;n++){this._placeBrick(p[n])}var h={};h.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var l=0;n=this.cols;while(--n){if(this.colYs[n]!==0){break}l++}h.width=(this.cols-l)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:h});var j=!this.isLaidOut?"css":(this.options.isAnimated?"animate":"css"),k=this.options.animationOptions;var m;for(n=0,o=this.styleQueue.length;n<o;n++){m=this.styleQueue[n];m.$el[j](m.style,k)}this.styleQueue=[];if(q){q.call(p)}this.isLaidOut=true},_getColumns:function(){var h=this.options.isFitWidth?this.element.parent():this.element,i=h.width();this.columnWidth=this.isFluid?this.options.columnWidth(i):this.options.columnWidth||this.$bricks.outerWidth(true)||i;this.columnWidth+=this.options.gutterWidth;this.cols=Math.floor((i+this.options.gutterWidth)/this.columnWidth);this.cols=Math.max(this.cols,1)},_placeBrick:function(q){var o=f(q),s,w,l,u,m;s=Math.ceil(o.outerWidth(true)/this.columnWidth);s=Math.min(s,this.cols);if(s===1){l=this.colYs}else{w=this.cols+1-s;l=[];for(m=0;m<w;m++){u=this.colYs.slice(m,m+s);l[m]=Math.max.apply(Math,u)}}var h=Math.min.apply(Math,l),v=0;for(var n=0,r=l.length;n<r;n++){if(l[n]===h){v=n;break}}var p={top:h+this.offset.y};p[this.horizontalDirection]=this.columnWidth*v+this.offset.x;this.styleQueue.push({$el:o,style:p});var t=h+o.outerHeight(true),k=this.cols+1-r;for(n=0;n<k;n++){this.colYs[v+n]=t}},resize:function(){var h=this.cols;this._getColumns();if(this.isFluid||this.cols!==h){this._reLayout()}},_reLayout:function(j){var h=this.cols;this.colYs=[];while(h--){this.colYs.push(0)}this.layout(this.$bricks,j)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(h){this.reloadItems();this._init(h)},appended:function(i,j,k){if(j){this._filterFindBricks(i).css({top:this.element.height()});var h=this;setTimeout(function(){h._appended(i,k)},1)}else{this._appended(i,k)}},_appended:function(h,j){var i=this._getBricks(h);this.$bricks=this.$bricks.add(i);this.layout(i,j)},remove:function(h){this.$bricks=this.$bricks.not(h);h.remove()},destroy:function(){this.$bricks.removeClass("grid-brick").each(function(){this.style.position="";this.style.top="";this.style.left=""});var h=this.element[0].style;for(var i in this.originalStyle){h[i]=this.originalStyle[i]}this.element.unbind(".grid").removeClass("grid").removeData("grid");f(e).unbind(".grid")}};
/*!
   * jQuery imagesLoaded plugin v1.1.0
   * http://github.com/desandro/imagesloaded
   *
   * MIT License. by Paul Irish et al.
   */
;f.fn.imagesLoaded=function(o){var m=this,k=m.find("img").add(m.filter("img")),h=k.length,n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",j=[];function l(){o.call(m,k)}function i(q){var p=q.target;if(p.src!==n&&f.inArray(p,j)===-1){j.push(p);if(--h<=0){setTimeout(l);k.unbind(".imagesLoaded",i)}}}if(!h){l()}k.bind("load.imagesLoaded error.imagesLoaded",i).each(function(){var p=this.src;this.src=n;this.src=p});return m};var c=function(h){if(e.console){e.console.error(h)}};f.fn.grid=function(j){var h=function(w){var E=f.extend({},f.fn.grid.defaults,j);if(j==g){j={}}j.isFitWidth=E.isFitWidth;j.isAnimated=E.isAnimated;j.itemSelector=".agrg_box";j.gutterWidth=E.horizontalSpaceBetweenThumbnails;var t=f(w);var J=E.columnWidth;if(J=="auto"){j.columnWidth=function(au){var av=-999;for(var at=E.columns;at>=1;at--){if(av<E.columnMinWidth){av=(((au-(at-1)*j.gutterWidth)/at)|0)}}t.find("div.agrg_box").width(av);return av}}else{if((typeof J)!="function"){j.columnWidth=function(at){var au=J;t.find("div.agrg_box").width(au);return au}}}t.find("div.agrg_box").css("margin-bottom",E.verticalSpaceBetweenThumbnails);var N=null;var an=t.data("directory");var aq=t.data("path");var C=f('<ul class="category-navbar" />').hide().insertBefore(t);var aj=function(){var at=C.find("li[class=select]").data("category");return at};var am=f("<div />").insertAfter(t);var I=function(){am.addClass("grid-loader").removeClass("grid-loadMore").html("")};var T=function(){am.removeClass("grid-loader")};var P=false;var q=function(ax){var au=0;for(var aw in N){var at=N[aw];if(ax==aw||ax=="all"){for(var av in at){au++}}}if(au>0){P=false;return true}else{return false}};var u=function(at){if(at){am.addClass("grid-loadMore").html("LOAD MORE IMAGES")}else{am.removeClass("grid-loadMore").html("")}};var D=function(aw,aD,at){var aC="thumbnails/";if(at=="no"){aC=""}var au=aw+"/";if(aw=="all"){au=""}var ay=aD.split(/\.(?=[^.]*$)/)[0];var ax="<h5>In "+aw+"</h5>";if(aw=="all"||E.captionCategory==false){ax=""}var av="";if(ay.indexOf("$$")!=-1){var aA=ay.split("$$");ay=aA[0];var aB=aA[1].split(":").join("/");aB=aB.split("|").join("/");av='data-url="'+aB+'"'}if(ay.substr(1,1)=="-"){ay=ay.substr(2)}var az='<div class="agrg_box" data-category="'+aw+'" '+av+'><img src="'+aq+an+"/"+au+aC+aD+'" data-lightbox="'+aq+an+"/"+au+aD+'" /><div class="image-caption"><h3>'+ay+"</h3>"+ax+'</div><div class="lightbox-text">'+ay+" <span>In "+aw+"</span></div></div>";return az};var l=function(){var at=aj();if(at!="all"){t.children("div").not('.agrg_box[data-category="'+at+'"]').removeClass("agrg_box grid-brick").hide()}};var k=function(at){at=f(at);at.css("margin-bottom",E.verticalSpaceBetweenThumbnails);t.append(at.hide());t.imagesLoaded(function(){at.hide().css({top:200,left:200});at.show();l();t.grid("reload");T();u(q(aj()));P=false})};var K=function(aw){var av=[];var at=Array();for(var au in aw){if(aw.hasOwnProperty(au)){av.push(aw[au].order.toLowerCase()+"-&$&$-"+au)}}av.sort();if(E.imagesOrder=="byName"||E.imagesOrder=="byDateReverse"){}else{av.reverse()}jQuery.each(av,function(az,ay){var ax=ay.split("-&$&$-");ax=ax[1];at.push(aw[ax])});return at};var r=function(av){I();var aC=0;for(var aE in N){var at=N[aE];var au=0;for(var ay in at){au++}if(au>aC){aC=au}}var aB=new Array();if(E.aleatoryImagesFromCategories){for(var ax=0;ax<aC;ax++){var aG=0;for(var aE in N){at=N[aE];var aF=aE;if(aG==0){aF="all"}var aD=0;for(var ay in at){if(aD==ax){aB.push({category:aF,image:ay,thumb:at[ay].thumb,order:at[ay].order,categoryOriginal:aE});break}aD++}aG++}}}else{var aG=0;for(var aE in N){var at=N[aE];var aF=aE;if(aG==0){aF="all"}for(var ay in at){aB.push({category:aF,image:ay,thumb:at[ay].thumb,order:at[ay].order,categoryOriginal:aE})}aG++}}if(E.orderInAll&&E.imagesOrder!="random"){aB=K(aB)}var aA="";var az=0;while(az<av){if(az>=aB.length){break}var aw=aB[az];aA+=D(aw.category,aw.image,aw.thumb);delete N[aw.categoryOriginal][aw.image];az++}k(aA)};var aa=function(au,aB){I();var az=new Array();var aD=0;for(var aA in N){var at=N[aA];var aC=aA;if(aD==0){aC="all"}if(aC==aB){for(var aw in at){az.push({category:aC,image:aw,thumb:at[aw].thumb,order:at[aw].order,categoryOriginal:aA})}}aD++}if(E.orderInAll&&E.imagesOrder!="random"){az=K(az)}var ay="";var ax=0;while(ax<au){if(ax>=az.length){break}var av=az[ax];ay+=D(av.category,av.image,av.thumb);delete N[av.categoryOriginal][av.image];ax++}k(ay)};var al=function(){if(am.hasClass("grid-loadMore")){var at=aj();if(at=="all"){r(E.imagesToLoad)}else{aa(E.imagesToLoad,at)}}};am.on("click",function(){al()});if(E.lazyLoad){f(e).scroll(function(){if(am.closest("html").length){if((f(e).scrollTop()==(f(document).height()-f(e)[0].innerHeight))&&P==false){P=true;al()}}})}var v=function(){var at=0;for(var au in N){var av=f("<li />").data("category",au).appendTo(C);f("<a />").html(au).appendTo(av);if(at==0){av.addClass("select");av.data("category","all")}at++}if(E.smartNavBar&&at<=2){E.showNavBar=false}if(E.showNavBar){C.slideDown(400)}};f.getJSON(aq+"reader.php?directory="+an+"&categoriesOrder="+E.categoriesOrder+"&imagesOrder="+E.imagesOrder,function(at){N=at;C.css("display","none");v();r(E.imagesToLoadStart)});C.on("click","a",function(at){at.preventDefault();var aw=jQuery(this);if(aw.parent("li").hasClass("select")){return}aw.parent("li").addClass("select").siblings("li").removeClass("select");var av=t;var au=aw.parent("li").data("category");if(au=="all"){av.children("div").show().addClass("agrg_box grid-brick").css({top:200,left:200})}else{av.children('div[data-category="'+au+'"]').show().addClass("agrg_box grid-brick").css({top:200,left:200});av.children("div").not('.agrg_box[data-category="'+au+'"]').removeClass("agrg_box grid-brick").hide()}t.grid("reload");u(q(aj()))});t.on("mouseenter.hoverdir, mouseleave.hoverdir","div.agrg_box",function(ay){if(!E.caption){return}var aw=f(this),ax=ay.type,av=aw.find("div.image-caption"),az=n(aw,{x:ay.pageX,y:ay.pageY}),au=ag(az,aw);var aA=av.children("div.aligment");if(aA[0]==g){var at=av.html();av.html("<div class='aligment'><div class='aligment'>"+at+"</div></div>")}if(ax==="mouseenter"){if(E.captionType=="classic"){av.css({left:0,top:0});av.fadeIn(300);return}av.css({left:au.from,top:au.to});av.stop().show().fadeTo(0,1,function(){f(this).stop().animate({top:0,left:0},200,"linear")})}else{if(E.captionType=="classic"){av.css({left:0,top:0});av.fadeOut(300);return}if(E.captionType=="grid-fade"){av.fadeOut(700)}else{av.stop().animate({left:au.from,top:au.to},200,"linear",function(){av.hide()})}}});var n=function(av,ay){var au=av.width(),aw=av.height(),at=(ay.x-av.offset().left-(au/2))*(au>aw?(aw/au):1),az=(ay.y-av.offset().top-(aw/2))*(aw>au?(au/aw):1),ax=Math.round((((Math.atan2(az,at)*(180/Math.PI))+180)/90)+3)%4;return ax};var ag=function(av,au){var aw,at;switch(av){case 0:if(!E.reverse){aw=0,at=-au.height()}else{aw=0,at=-au.height()}break;case 1:if(!E.reverse){aw=au.width(),at=0}else{aw=-au.width(),at=0}break;case 2:if(!E.reverse){aw=0,at=au.height()}else{aw=0,at=-au.height()}break;case 3:if(!E.reverse){aw=-au.width(),at=0}else{aw=au.width(),at=0}break}return{from:aw,to:at}};var W=f("body");var ae={interval:"none"};var p=0;var Q=f('<div class="autoGrid-lightbox" />').appendTo(W);var V=f('<div class="autoGrid-nav" />').appendTo(Q);var Y=f('<div class="autoGrid-close" />').appendTo(V);var U=f('<i class="iconClose" />').appendTo(Y);var y=f('<div class="autoGrid-play" />');if(E.lightboxPlayBtn){y.appendTo(V)}var F=f('<i class="iconPlay" />').appendTo(y);var ac=f('<div class="autoGrid-lbcaption" />').appendTo(V).html("Here will go the text for the lightbox");var ah=f('<div class="autoGrid-next" />').appendTo(V);var ap=f('<i class="iconNext" />').appendTo(ah);var B=f('<div class="autoGrid-prev" />').appendTo(V);var H=f('<i class="iconPrev" />').appendTo(B);var ab=f('<div class="lightbox-timer" />').appendTo(Q);var s=Y.width();var X=3;if(E.lightboxPlayBtn){X=4}var m=function(){var av=Q.outerWidth();if(av<650){ac.hide();ah.css("width",(av/X));B.css("width",(av/X));y.css("width",(av/X));Y.css("width",av-((av/X)*(X-1)))}else{ac.show();ah.css("width",s);B.css("width",s);y.css("width",s);Y.css("width",s)}var at=Q.find("img");var au=Q.outerHeight()-V.outerHeight()-10;at.css("max-height",au)};jQuery(e).resize(function(){m()});var S=new Image();var ak=function(){S.onload=null;S=null;Q.find("img").remove()};var M=function(){Q.find(".lb-loader").remove()};var A=function(){Q.append('<div class="lb-loader"/>')};Q.attr("unselectable","on").css("user-select","none").on("selectstart",false);var L=function(){ab.stop(true,true).width(0)};var ao=function(){clearInterval(ae.interval)};var z=function(){if(E.lightBoxShowTimer==false){return}ab.css({position:"absolute",bottom:0}).animate({width:"100%"},E.lightBoxPlayInterval,"linear",function(){L()})};var ar=false;var Z=false;var O=function(){ae.interval=setTimeout(function(){o()},E.lightBoxPlayInterval);z()};var x=function(){if(ar&&Z==false){L();ao();O()}};var af=f("<span />");var G=function(az,au){ak();M();A();var ax=0;var ay=0;if(au!=true){ax=0.9;ay=E.lightBoxSpeedFx}if(E.lightBoxZoomAnim==false){ax=1}var av=az;var aw=av.data("lightbox");if(aw==g){aw=av.attr("src")}var aC=av.siblings("div.lightbox-text").html();if(E.lightBoxText==false){aC=""}var aB="<div><div>"+aC+"</div></div>";ac.html(aB);S=new Image();var at=f(S);var aA=S;S.onload=function(){if(aA!=S){return}M();Q.append(at.hide().scale(ax));at.fadeIn(ay).animate({scale:"1"},{duration:E.lightBoxSpeedFx,complete:function(){x()}});m()};S.src=aw;af.stop(true);af=f(S)};var ai=false;t.on("click","div.agrg_box",function(){ai=true;var av=f(this);var au=av.data("url");if(au!=g){e.location.href="http://"+au;return}if(E.lightBox==false){return}Z=false;p=t.find(".agrg_box").index(this);var at=av.children("img");V.animate({"margin-top":0},E.lightBoxSpeedFx);Q.fadeIn(E.lightBoxSpeedFx);G(at,true)});Q.on("click","div",function(at){at.stopPropagation()});Q.on("click","img",function(at){at.stopPropagation()});Q.on("click",function(){ad()});Y.on("click",function(){ad()});var ad=function(){if(E.lightBoxStopPlayOnClose){y.removeClass("selected");ar=false}ai=false;Z=true;L();ao();Q.find(".lb-loader").remove();var au=0;if(E.lightBoxZoomAnim==false){au=1}var at=Q.find("img").stop().show();V.animate({"margin-top":-V.outerHeight()},E.lightBoxSpeedFx);if(at[0]!=g){at.animate({scale:au},E.lightBoxSpeedFx,function(){Q.fadeOut(100)})}else{Q.fadeOut(100)}};var o=function(){Z=false;var aw=t.find(".agrg_box");p+=1;if(p>=aw.length){p=0}if(!aw.eq(p).is(":visible")){var at=p;for(var av=0;av<aw.length;av++){at++;if(at>=aw.length){at=0}if(aw.eq(at).is(":visible")){p=at;break}}}var au=aw.eq(p).children("img");G(au)};var R=function(){Z=false;var aw=t.find(".agrg_box");p-=1;if(p<0){p=aw.length-1}if(!aw.eq(p).is(":visible")){var at=p;for(var av=0;av<aw.length;av++){at--;if(at<0){at=aw.length-1}if(aw.eq(at).is(":visible")){p=at;break}}}var au=aw.eq(p).children("img");G(au)};ah.on("click",function(){L();ao();o()});Q.on("click","img",function(){L();ao();o()});B.on("click",function(){L();ao();R()});f(document).keyup(function(at){if(!E.lightboxKeyboardNav){return}if(at.keyCode=="37"){if(ai==false){return}L();ao();R()}if(at.keyCode=="39"){if(ai==false){return}L();ao();o()}if(at.keyCode==27){ad()}});if(E.lightBoxAutoPlay){y.addClass("selected");ar=true}y.on("click",function(){w=f(this);if(w.hasClass("selected")){w.removeClass("selected");ar=false;L();ao()}else{w.addClass("selected");ar=true;O()}})};if(typeof j==="string"){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var k=f.data(this,"grid");if(!k){c("cannot call methods on grid prior to initialization; attempted to call method '"+j+"'");return}if(!f.isFunction(k[j])||j.charAt(0)==="_"){c("no such method '"+j+"' for grid instance");return}k[j].apply(k,i)})}else{this.each(function(){var k=f.data(this,"grid");if(k){k.option(j||{});k._init()}else{h(this);f.data(this,"grid",new f.Mason(j,this))}})}return this};f.fn.grid.defaults={categoriesOrder:"byDate",imagesOrder:"byDate",orderInAll:true,isFitWidth:true,lazyLoad:false,showNavBar:true,smartNavBar:true,imagesToLoadStart:15,imagesToLoad:5,aleatoryImagesFromCategories:true,horizontalSpaceBetweenThumbnails:5,verticalSpaceBetweenThumbnails:5,columnWidth:"auto",columns:5,columnMinWidth:220,isAnimated:true,caption:true,captionCategory:true,captionType:"grid-fade",lightBox:true,lightboxKeyboardNav:true,lightBoxSpeedFx:500,lightBoxZoomAnim:true,lightBoxText:true,lightboxPlayBtn:true,lightBoxAutoPlay:false,lightBoxPlayInterval:4000,lightBoxShowTimer:true,lightBoxStopPlayOnClose:false}})(window,jQuery);
